# Google Cloud Identity and Access Management Terraform module
Terraform module for creation Google Cloud Identity and Access Management resources

## Usage

<!-- BEGIN_TF_DOCS -->
## Requirements
| Name                                                                      | Version   |
| ------------------------------------------------------------------------- | --------- |
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.0.0  |
| <a name="requirement_google"></a> [google](#requirement\_google)          | >= 4.43.0 |

## Providers
| Name                                                       | Version |
| ---------------------------------------------------------- | ------- |
| <a name="provider_google"></a> [google](#provider\_google) | 4.43.0  |

## Modules
No modules.

## Resources
| Name                                                                                                                                                                     | Type     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| [google_service_account.composer_sa](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_service_account)                              | resource |
| [google_project_iam_member.composer-worker](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam#google_project_iam_member) | resource |
| [google_project_iam_member.composer_agent](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam#google_project_iam_member)  | resource |
| [google_service_account.services_sa](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_service_account)                              | resource |
| [google_project_iam_custom_role.services_sa_role](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam_custom_role)         | resource |
| [google_project_iam_member.services_sa](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam#google_project_iam_member)     | resource |
| [google_service_account_key.services_sa_key](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_service_account_key)                  | resource |
| [random_string.main](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string)                                                              | resource |

## Inputs
| Name                                                                                      | Description                                                                | Type          | Default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Required |
| ----------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- | ------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_project_id"></a> [project\_id](#input\_project\_id)                        | The ID of the project to which the resource belongs                        | `string`      | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   yes    |
| <a name="input_project_number"></a> [project\_number](#input\_project\_number)            | The numeric identifier of the GCP project                                  | `string`      | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   yes    |
| <a name="input_product_base_name"></a> [product\_base\_name](#input\_product\_base\_name) | Cloud resources base name (used to create services)                        | `string`      | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   yes    |
| <a name="input_env"></a> [env](#input\_env)                                               | Variable to mark the environment of the resource (used to create services) | `string`      | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   yes    |
| <a name="input_composer_roles"></a> [composer\_roles](#input\_composer\_roles)            | The role that should be applied for Composer service account               | `set(string)` | <pre>["roles/datapipelines.serviceAgent",<br> "roles/secretmanager.secretAccessor",<br> "roles/composer.worker",<br> "roles/bigquery.dataEditor"]</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |   yes    |
| <a name="input_sa_permissions"></a> [sa\_permissions](#input\_sa\_permissions)            | Permissions for service accounts                                           | `map(any)`    | <pre>{<br>raw_serverless =<br>   ["bigquery.datasets.get",<br>    "bigquery.tables.create",<br>    "bigquery.tables.get",<br>    "bigquery.tables.list",<br>    "dataflow.jobs.get",<br>    "dataflow.jobs.list",<br>    "iam.serviceAccounts.actAs",<br>    "secretmanager.versions.access",<br>    "storage.buckets.get",<br>    "storage.objects.get",<br>    "storage.objects.list"]<br>dp_serverless  =<br>   ["bigquery.jobs.create",<br>    "bigquery.tables.create",<br>    "bigquery.tables.delete",<br>    "bigquery.tables.getData",<br>    "bigquery.tables.updateData",<br>    "storage.objects.get",<br>    "storage.objects.list"]<br>raw_spark      =<br>   ["bigquery.jobs.create",<br>    "bigquery.tables.create",<br>    "bigquery.tables.delete",<br>    "bigquery.tables.get",<br>    "bigquery.tables.update",<br>    "bigquery.tables.updateData",<br>    "dataproc.agents.create",<br>    "dataproc.agents.delete",<br>    "dataproc.agents.get",<br>    "dataproc.agents.list",<br>    "dataproc.agents.update",<br>    "dataproc.clusters.create",<br>    "dataproc.clusters.delete",<br>    "dataproc.clusters.use",<br>    "dataproc.jobs.create",<br>    "dataproc.jobs.get",<br>    "dataproc.operations.get",<br>    "dataproc.operations.list",<br>    "dataproc.tasks.lease",<br>    "dataproc.tasks.listInvalidatedLeases",<br>    "dataproc.tasks.reportStatus",<br>    "iam.serviceAccounts.actAs",<br>    "iam.serviceAccounts.get",<br>    "secretmanager.versions.access",<br>    "storage.objects.create",<br>    "storage.buckets.get",<br>    "storage.objects.delete",<br>    "storage.objects.get",<br>    "storage.objects.list"]<br>dp_spark       =<br>   ["bigquery.jobs.create",<br>    "bigquery.tables.create",<br>    "bigquery.tables.delete",<br>    "bigquery.tables.get",<br>    "bigquery.tables.update",<br>    "bigquery.tables.updateData",<br>    "dataproc.agents.create",<br>    "dataproc.agents.delete",<br>    "dataproc.agents.get",<br>    "dataproc.agents.list",<br>    "dataproc.agents.update",<br>    "dataproc.clusters.create",<br>    "dataproc.clusters.delete",<br>    "dataproc.clusters.use",<br>    "dataproc.jobs.create",<br>    "dataproc.jobs.get",<br>    "dataproc.operations.get",<br>    "dataproc.operations.list",<br>    "dataproc.tasks.lease",<br>    "dataproc.tasks.listInvalidatedLeases",<br>    "dataproc.tasks.reportStatus",<br>    "iam.serviceAccounts.actAs",<br>    "storage.objects.create",<br>    "storage.objects.delete",<br>    "storage.objects.get",<br>    "storage.objects.list",<br>    "storage.buckets.get"]<br>}</pre> |   yes    |

## Outputs
| Name                                                                                                            | Description                          |
| --------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| <a name="output_composer_sa_email"></a> [composer\_sa\_email](#output\_composer\_sa\_email)                     | Service account for composer         |
| <a name="output_raw_serverless_sa_email"></a> [raw\_serverless\_sa\_email](#output\_raw\_serverless\_sa\_email) | raw_serverless service account email |
| <a name="output_raw_spark_sa_email"></a> [raw\_spark\_sa\_email](#output\_raw\_spark\_sa\_email)                | raw_spark service account email      |
| <a name="output_dp_serverless_sa_email"></a> [dp\_serverless\_sa\_email](#output\_dp\_serverless\_sa\_email)    | dp_serverless service account email  |
| <a name="output_dp_spark_sa_email"></a> [dp_spark\_sa\_email](#output\_dp_spark\_sa\_email)                     | dp_spark service account email       |
| <a name="output_raw_serverless_sa_key"></a> [raw\_serverless\_sa\_key](#output\_raw\_serverless\_sa\_key)       | raw_serverless service account key   |
| <a name="output_raw_spark_sa_key"></a> [raw\_spark\_sa\_key](#output\_raw\_spark\_sa\_key)                      | raw_spark service account key        |
| <a name="output_dp_serverless_sa_key"></a> [dp\_serverless\_sa\_key](#output\_dp\_serverless\_sa\_key)          | dp_serverless service account key    |
| <a name="output_dp_spark_sa_key"></a> [dp\_spark\_sa\_key](#output\_dp\_spark\_sa\_key)                         | dp_spark service account key         |

<!-- END_TF_DOCS -->

## License
Apache 2 Licensed. For more information please see [LICENSE](https://github.com/data-platform-hq/terraform-google-cloud-iam/blob/main/LICENSE)